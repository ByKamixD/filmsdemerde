<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Librairie de Films</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8581760997356468"
     crossorigin="anonymous"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #121725;
            --bg-tertiary: #1a1f2e;
            --bg-card: rgba(26, 31, 46, 0.6);
            --border-color: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --text-tertiary: #718096;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --purple: #8b5cf6;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.4);
        }

        body.light-mode {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --bg-card: rgba(255, 255, 255, 0.9);
            --border-color: rgba(0, 0, 0, 0.08);
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #64748b;
            --shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(12px);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent), var(--purple));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .icon-btn {
            width: 42px;
            height: 42px;
            border-radius: var(--radius-sm);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .icon-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: scale(1.05);
        }

        .icon-btn:active {
            transform: scale(0.95);
        }

        .icon-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        /* Search Bar */
        .search-section {
            margin-bottom: 32px;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 16px 20px 16px 52px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s ease;
            backdrop-filter: blur(12px);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .search-box input::placeholder {
            color: var(--text-tertiary);
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            color: var(--text-tertiary);
        }

        /* Controls */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 32px;
            align-items: center;
        }

        .control-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 18px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(12px);
        }

        .btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .btn svg {
            width: 16px;
            height: 16px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            border-color: var(--accent-hover);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .btn-success:hover {
            background: #059669;
            border-color: #059669;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
        }

        .btn-warning:hover {
            background: #d97706;
            border-color: #d97706;
        }

        .btn-purple {
            background: var(--purple);
            color: white;
            border-color: var(--purple);
        }

        .btn-purple:hover {
            background: #7c3aed;
            border-color: #7c3aed;
        }

        select {
            padding: 10px 36px 10px 14px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            cursor: pointer;
            backdrop-filter: blur(12px);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a0aec0' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .movie-count {
            margin-left: auto;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        /* Filter Pills */
        .filter-pills {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }

        .filter-pill {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-pill:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .filter-pill.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Movies Grid */
        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 48px;
        }

        .movie-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            backdrop-filter: blur(12px);
        }

        .movie-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent);
        }

        .movie-poster {
            width: 100%;
            aspect-ratio: 2/3;
            object-fit: cover;
            display: block;
        }

        .movie-content {
            padding: 16px;
        }

        .movie-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .movie-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
        }

        .movie-year {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .movie-rating {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: var(--warning);
            font-weight: 600;
        }

        .movie-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-favorite {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .badge-watched {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
        }

        .badge-towatch {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Skeleton Loading */
        .skeleton-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
            backdrop-filter: blur(12px);
        }

        .skeleton-poster {
            width: 100%;
            aspect-ratio: 2/3;
            background: linear-gradient(90deg, var(--bg-tertiary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        .skeleton-content {
            padding: 16px;
        }

        .skeleton-title {
            height: 20px;
            background: linear-gradient(90deg, var(--bg-tertiary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
            margin-bottom: 12px;
        }

        .skeleton-meta {
            height: 14px;
            width: 60%;
            background: linear-gradient(90deg, var(--bg-tertiary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Bottom Mobile Navigation */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 12px 8px calc(12px + env(safe-area-inset-bottom));
            display: none;
            z-index: 90;
            backdrop-filter: blur(12px);
        }

        .mobile-nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 8px;
            min-width: 60px;
        }

        .mobile-nav-item:active {
            transform: scale(0.95);
        }

        .mobile-nav-item.active {
            color: var(--accent);
            background: rgba(99, 102, 241, 0.1);
        }

        .mobile-nav-item svg {
            width: 22px;
            height: 22px;
        }

        .mobile-nav-item span {
            font-size: 11px;
            font-weight: 500;
        }

        /* Star Rating */
        .star-rating {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .star {
            width: 20px;
            height: 20px;
            cursor: pointer;
            color: var(--text-tertiary);
            transition: all 0.2s ease;
        }

        .star:hover,
        .star.active {
            color: #fbbf24;
            transform: scale(1.1);
        }

        .star-rating-large .star {
            width: 28px;
            height: 28px;
        }

        .rating-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .rating-label {
            color: var(--text-tertiary);
            font-size: 12px;
        }

        /* Modal Backdrop */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal-backdrop.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-backdrop.active .modal {
            transform: scale(1);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        .modal-close svg {
            width: 18px;
            height: 18px;
        }

        .modal-body {
            padding: 24px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Floating Account Button */
        .account-fab {
            position: fixed;
            bottom: 32px;
            right: 32px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--purple));
            border: none;
            color: white;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .account-fab:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .account-fab:active {
            transform: scale(0.95);
        }

        .account-fab svg {
            width: 24px;
            height: 24px;
        }

        .account-menu {
            position: fixed;
            bottom: 100px;
            right: 32px;
            width: 240px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transform: translateY(10px);
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 49;
            overflow: hidden;
        }

        .account-menu.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        .account-menu-item {
            width: 100%;
            padding: 14px 16px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .account-menu-item:last-child {
            border-bottom: none;
        }

        .account-menu-item:hover {
            background: var(--bg-tertiary);
        }

        .account-menu-item svg {
            width: 18px;
            height: 18px;
            color: var(--text-tertiary);
        }

        /* Updates Panel */
        .updates-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 32px;
            backdrop-filter: blur(12px);
            display: none;
        }

        .updates-panel.active {
            display: block;
        }

        .update-item {
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .update-item:last-child {
            border-bottom: none;
        }

        .update-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .update-desc {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            padding: 16px 20px;
            background: var(--success);
            color: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            font-size: 14px;
            font-weight: 600;
            z-index: 2000;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 24px;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 64px;
            height: 64px;
            border: 6px solid var(--border-color);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .loading-text {
            color: white;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            max-width: 400px;
            padding: 0 20px;
        }

        .loading-subtext {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            margin-top: -12px;
        }

        /* Advertising */
        .ad-container-horizontal {
            max-width: 1400px;
            margin: 0 auto 32px;
            padding: 0 24px;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ad-container-vertical {
            position: fixed;
            top: 100px;
            width: 160px;
            min-height: 600px;
            z-index: 40;
        }

        .ad-container-vertical-left {
            left: 0;
        }

        .ad-container-vertical-right {
            right: 0;
        }

        .ad-container-multiplex {
            max-width: 1400px;
            margin: 48px auto 32px;
            padding: 0 24px;
            min-height: 250px;
        }

        /* AdBlock Detection Popup */
        .adblock-popup {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 5000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .adblock-popup.active {
            display: flex;
        }

        .adblock-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            max-width: 500px;
            width: 100%;
            padding: 32px;
            text-align: center;
        }

        .adblock-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            color: var(--warning);
        }

        .adblock-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .adblock-message {
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .adblock-close-btn {
            padding: 14px 32px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-tertiary);
            font-size: 14px;
            font-weight: 600;
            font-family: inherit;
            cursor: not-allowed;
            transition: all 0.2s ease;
            opacity: 0.5;
        }

        .adblock-close-btn.enabled {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            cursor: pointer;
            opacity: 1;
        }

        .adblock-close-btn.enabled:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
        }

        .adblock-timer {
            display: block;
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 12px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                padding: 16px;
            }

            .logo {
                font-size: 20px;
            }

            .container {
                padding: 24px 16px 100px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .control-group {
                width: 100%;
            }

            .btn, select {
                width: 100%;
                justify-content: center;
            }

            .movie-count {
                margin-left: 0;
                text-align: center;
            }

            .movies-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 12px;
            }

            .movie-title {
                font-size: 14px;
            }

            .movie-meta {
                font-size: 12px;
            }

            .account-fab {
                display: none;
            }

            .account-menu {
                display: none;
            }

            .mobile-nav {
                display: block;
            }

            .modal {
                max-width: 95%;
                margin: 10px;
            }

            .modal-body {
                padding: 16px;
            }

            .filter-pills {
                display: none;
            }

            .ad-container-vertical {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .movies-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .logo-icon {
                width: 28px;
                height: 28px;
            }

            .logo span {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <svg fill="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                        <path d="M18 3v2h-2V3H8v2H6V3H4v18h2v-2h2v2h8v-2h2v2h2V3h-2zM8 17H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm10 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z"/>
                    </svg>
                </div>
                <span>Librairie</span>
            </div>
            <div class="header-actions">
                <button class="icon-btn" onclick="toggleDarkMode()" title="Changer de thème">
                    <svg id="darkModeIcon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Z"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Vertical Ads -->
    <div class="ad-container-vertical ad-container-vertical-left">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-8581760997356468"
             data-ad-slot="9772479040"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div class="ad-container-vertical ad-container-vertical-right">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-8581760997356468"
             data-ad-slot="9772479040"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Search -->
        <div class="search-section">
            <div class="search-box">
                <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <input type="text" id="searchInput" placeholder="Rechercher un film...">
            </div>
        </div>

        <!-- Filter Pills -->
        <div class="filter-pills">
            <button class="filter-pill active" data-filter="all" onclick="filterByStatus('all')">Tous</button>
            <button class="filter-pill" data-filter="favorite" onclick="filterByStatus('favorite')">Favoris</button>
            <button class="filter-pill" data-filter="watched" onclick="filterByStatus('watched')">Vus</button>
            <button class="filter-pill" data-filter="toWatch" onclick="filterByStatus('toWatch')">À voir</button>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="control-group">
                <select id="sortSelect" onchange="handleSortChange()">
                    <option value="year-desc">Plus récents</option>
                    <option value="year">Plus anciens</option>
                    <option value="title">Titre (A-Z)</option>
                    <option value="title-desc">Titre (Z-A)</option>
                    <option value="tmdb-rating-desc">Mieux notés</option>
                    <option value="tmdb-rating">Moins notés</option>
                </select>
                <button class="btn btn-success" onclick="loadMovies(true)">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    Actualiser
                </button>
            </div>
            <div class="control-group">
                <button class="btn btn-primary" onclick="toggleWebsiteUpdates()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    Mises à jour
                </button>
                <button class="btn btn-purple" onclick="toggleMovieChangelog()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Historique
                </button>
                <button class="btn btn-warning" onclick="openSuggestModal()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                    Suggérer
                </button>
            </div>
            <div class="movie-count" id="movieCount">0 films</div>
        </div>

        <!-- Website Updates Panel -->
        <div class="updates-panel" id="websiteUpdates">
            <h3 style="margin-bottom: 20px; font-size: 18px; font-weight: 700;">Mises à jour du site</h3>
            <div class="update-item">
                <div class="update-title">Ajout de suggestion vu à voir etc</div>
                <div class="update-desc">Nouvelle fonctionnalité pour gérer vos films</div>
            </div>
            <div class="update-item">
                <div class="update-title">Mode sombre & clair</div>
                <div class="update-desc">Changez l'apparence selon vos préférences</div>
            </div>
            <div class="update-item">
                <div class="update-title">Import/Export des données</div>
                <div class="update-desc">Synchronisez vos données entre appareils</div>
            </div>
        </div>

        <!-- Movie Changelog Panel -->
        <div class="updates-panel" id="movieChangelog">
            <h3 style="margin-bottom: 20px; font-size: 18px; font-weight: 700;">Historique des films</h3>
            <div id="movieChangelogContent"></div>
        </div>
    </div>

    <!-- Horizontal Ad -->
    <div class="ad-container-horizontal">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-8581760997356468"
             data-ad-slot="8266049588"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div class="container">
        <!-- Movies Grid -->
        <div class="movies-grid" id="moviesContainer">
            <div class="loading">
                <div class="spinner"></div>
                <div>Chargement des films...</div>
            </div>
        </div>
    </div>

    <!-- Multiplex Ad -->
    <div class="ad-container-multiplex">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-format="autorelaxed"
             data-ad-client="ca-pub-8581760997356468"
             data-ad-slot="7062555226"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <!-- Floating Account Button -->
    <button class="account-fab" onclick="toggleAccountMenu()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>
    </button>

    <!-- Account Menu -->
    <div class="account-menu" id="accountMenu">
        <button class="account-menu-item" onclick="openExportModal(); closeAccountMenu();">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
            </svg>
            Exporter
        </button>
        <button class="account-menu-item" onclick="openImportModal(); closeAccountMenu();">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
            </svg>
            Importer
        </button>
    </div>

    <!-- Movie Detail Modal -->
    <div class="modal-backdrop" id="movieModal">
        <div class="modal" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle"></h2>
                <button class="modal-close" onclick="closeMovieModal()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- Suggest Movie -->
    <div class="modal-backdrop" id="suggestModal">
        <div class="modal">
            <div class="modal-header">
                <div>
                    <h2 class="modal-title">Suggérer un film</h2>
                    <p style="color: var(--text-tertiary); font-size: 13px; margin-top: 4px;">Proposez un film à ajouter</p>
                </div>
                <button class="modal-close" onclick="closeSuggestModal()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="suggestionForm" action="https://formsubmit.co/82dfe368057a38052165572f3069e1e4" method="POST">
                    <input type="hidden" name="_subject" value="Nouvelle suggestion de film">
                    <input type="hidden" name="_captcha" value="false">
                    <input type="hidden" name="_template" value="table">
                    <input type="hidden" name="_next" id="formRedirect">

                    <div class="form-group">
                        <label class="form-label">Titre du film *</label>
                        <input class="form-input" type="text" name="titre" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Année</label>
                        <input class="form-input" type="number" name="annee" min="1900" max="2030">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Version</label>
                        <select class="form-select" name="version">
                            <option value="VF">VF (Version Française)</option>
                            <option value="VOSTFR">VOSTFR (Sous-titres français)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Votre email (optionnel)</label>
                        <input class="form-input" type="email" name="email" placeholder="Pour vous recontacter si besoin">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Demandes spéciales (autre langue, format, etc.)</label>
                        <textarea class="form-textarea" name="demandes" placeholder="Précisez toute demande particulière ici..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
                        Envoyer la suggestion
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal-backdrop" id="exportModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Votre code d'export</h2>
                <button class="modal-close" onclick="closeExportModal()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-tertiary); font-size: 13px; margin-bottom: 16px; text-align: center;">
                    Copiez ce code pour synchroniser vos données sur un autre appareil
                </p>
                <div style="background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 20px; margin-bottom: 16px;">
                    <div id="exportCodeDisplay" style="font-family: 'Courier New', monospace; font-size: 13px; color: var(--text-primary); word-break: break-all; line-height: 1.6; user-select: all;"></div>
                </div>
                <button class="btn btn-success" onclick="copyExportCode()" style="width: 100%; justify-content: center;">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                    </svg>
                    Copier le code
                </button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal-backdrop" id="importModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Importer vos données</h2>
                <button class="modal-close" onclick="closeImportModal()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-tertiary); font-size: 13px; margin-bottom: 16px; text-align: center;">
                    Collez votre code d'export pour restaurer vos données
                </p>
                <textarea id="importCodeInput" class="form-textarea" placeholder="Collez votre code ici..." style="min-height: 120px; font-family: 'Courier New', monospace; font-size: 13px;"></textarea>
                <button class="btn btn-purple" onclick="importFromCode()" style="width: 100%; justify-content: center; margin-top: 16px;">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                    </svg>
                    Restaurer les données
                </button>
                <p style="color: var(--danger); font-size: 12px; margin-top: 12px; text-align: center; font-weight: 600;">
                    ATTENTION : Cela remplacera vos données actuelles
                </p>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-nav">
        <div class="mobile-nav-items">
            <button class="mobile-nav-item active" data-nav="all" onclick="mobileNavFilter('all')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                </svg>
                <span>Tous</span>
            </button>
            <button class="mobile-nav-item" data-nav="favorite" onclick="mobileNavFilter('favorite')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
                <span>Favoris</span>
            </button>
            <button class="mobile-nav-item" data-nav="suggest" onclick="openSuggestModal()">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                <span>Suggérer</span>
            </button>
            <button class="mobile-nav-item" data-nav="watched" onclick="mobileNavFilter('watched')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span>Vus</span>
            </button>
            <button class="mobile-nav-item" data-nav="account" onclick="openAccountMenu()">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                <span>Compte</span>
            </button>
        </div>
    </nav>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Envoi de votre suggestion en cours...</div>
        <div class="loading-subtext">Ne quittez pas cette page</div>
    </div>

    <!-- Welcome Modal -->
    <div class="modal-backdrop" id="welcomeModal" style="z-index: 4000;">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <div>
                    <h2 class="modal-title">Bienvenue sur la Librairie</h2>
                    <p style="color: var(--text-tertiary); font-size: 13px; margin-top: 4px;">Votre cinémathèque gratuite</p>
                </div>
                <button class="modal-close" onclick="closeWelcomeModal()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1)); padding: 20px; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                        <div style="font-size: 15px; font-weight: 600; margin-bottom: 8px; color: var(--accent);">Gratuit & Accessible</div>
                        <div style="font-size: 14px; line-height: 1.6; color: var(--text-secondary);">
                            Ce site est entièrement gratuit. Aucun VPN n'est nécessaire pour télécharger les films depuis nos liens.
                        </div>
                    </div>

                    <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1)); padding: 20px; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                        <div style="font-size: 15px; font-weight: 600; margin-bottom: 8px; color: var(--success);">Suggestions</div>
                        <div style="font-size: 14px; line-height: 1.6; color: var(--text-secondary);">
                            Vous pouvez suggérer des films à ajouter en cliquant sur le bouton "Suggérer" en haut de la page.
                        </div>
                    </div>

                    <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1)); padding: 20px; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                        <div style="font-size: 15px; font-weight: 600; margin-bottom: 8px; color: var(--warning);">À propos</div>
                        <div style="font-size: 14px; line-height: 1.6; color: var(--text-secondary);">
                            Ce site a été créé par un français random qui aime partager des films.
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="closeWelcomeModal()" style="width: 100%; justify-content: center; margin-top: 24px; padding: 14px;">
                    Compris, commencer à explorer
                </button>
            </div>
        </div>
    </div>

    <!-- AdBlock Detection Popup -->
    <div class="adblock-popup" id="adblockPopup">
        <div class="adblock-content">
            <svg class="adblock-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            <h2 class="adblock-title">Désactivez votre bloqueur de publicités</h2>
            <p class="adblock-message">
                Ce site est entièrement gratuit et les publicités nous aident à maintenir ce service.
                Veuillez désactiver votre bloqueur de publicités pour continuer à profiter de nos films gratuitement.
            </p>
            <button class="adblock-close-btn" id="adblockCloseBtn" onclick="closeAdblockPopup()">
                Fermer (<span id="adblockTimer">20</span>s)
            </button>
            <span class="adblock-timer">Vous pourrez fermer cette fenêtre dans <span id="adblockTimerText">20</span> secondes</span>
        </div>
    </div>

    <script>
        // Global Variables
        let allMovies = [];
        let filteredMovies = [];
        let currentMovie = null;
        let currentStatusFilter = 'all';
        let currentSort = 'year-desc';
        let personalData = {};

        // Load personal data from localStorage
        function loadPersonalData() {
            const saved = localStorage.getItem('moviePersonalData');
            if (saved) {
                personalData = JSON.parse(saved);
            }
        }

        // Save personal data to localStorage
        function savePersonalData() {
            localStorage.setItem('moviePersonalData', JSON.stringify(personalData));
        }

        // Get personal data for a movie
        function getMoviePersonalData(movieId) {
            return personalData[movieId] || {
                favorite: false,
                watched: false,
                toWatch: false,
                notes: '',
                watchDate: null,
                rating: 0
            };
        }

        // Compression helpers for cross-device sharing
        function compressData(data) {
            const json = JSON.stringify(data);
            const compressed = json
                .replace(/"version"/g, '"v"')
                .replace(/"exportDate"/g, '"d"')
                .replace(/"darkMode"/g, '"m"')
                .replace(/"personalData"/g, '"p"')
                .replace(/"favorite"/g, '"f"')
                .replace(/"watched"/g, '"w"')
                .replace(/"toWatch"/g, '"t"')
                .replace(/"notes"/g, '"n"')
                .replace(/"watchDate"/g, '"wd"')
                .replace(/"rating"/g, '"r"')
                .replace(/\s+/g, '');
            return btoa(encodeURIComponent(compressed));
        }

        function decompressData(code) {
            try {
                const compressed = decodeURIComponent(atob(code));
                const json = compressed
                    .replace(/"v"/g, '"version"')
                    .replace(/"d"/g, '"exportDate"')
                    .replace(/"m"/g, '"darkMode"')
                    .replace(/"p"/g, '"personalData"')
                    .replace(/"f"/g, '"favorite"')
                    .replace(/"w"/g, '"watched"')
                    .replace(/"t"/g, '"toWatch"')
                    .replace(/"n"/g, '"notes"')
                    .replace(/"wd"/g, '"watchDate"')
                    .replace(/"r"/g, '"rating"');
                return JSON.parse(json);
            } catch (e) {
                return null;
            }
        }

        // Toggle account menu
        function toggleAccountMenu() {
            const menu = document.getElementById('accountMenu');
            menu.classList.toggle('active');
        }

        function closeAccountMenu() {
            document.getElementById('accountMenu').classList.remove('active');
        }

        // Close account menu when clicking outside
        document.addEventListener('click', function(e) {
            const fab = document.querySelector('.account-fab');
            const menu = document.getElementById('accountMenu');
            if (!fab.contains(e.target) && !menu.contains(e.target)) {
                closeAccountMenu();
            }
        });

        // Export/Import functions
        function openExportModal() {
            const exportData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                darkMode: localStorage.getItem('darkMode') || 'dark',
                personalData: personalData
            };

            const code = compressData(exportData);
            document.getElementById('exportCodeDisplay').textContent = code;
            document.getElementById('exportModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function copyExportCode() {
            const code = document.getElementById('exportCodeDisplay').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showNotification('Code copié !', 'success');
            }).catch(() => {
                const temp = document.createElement('textarea');
                temp.value = code;
                document.body.appendChild(temp);
                temp.select();
                document.execCommand('copy');
                document.body.removeChild(temp);
                showNotification('Code copié !', 'success');
            });
        }

        function openImportModal() {
            document.getElementById('importCodeInput').value = '';
            document.getElementById('importModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function importFromCode() {
            const code = document.getElementById('importCodeInput').value.trim();

            if (!code) {
                showNotification('Entrez un code valide', 'error');
                return;
            }

            const importData = decompressData(code);

            if (!importData || !importData.personalData) {
                showNotification('Code invalide', 'error');
                return;
            }

            personalData = importData.personalData;
            savePersonalData();

            if (importData.darkMode) {
                localStorage.setItem('darkMode', importData.darkMode);
                loadDarkModePreference();
            }

            displayMovies();
            closeImportModal();
            showNotification('Données restaurées !', 'success');
        }

        // Dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('light-mode');
            const isDark = !document.body.classList.contains('light-mode');

            const icon = document.getElementById('darkModeIcon');
            if (isDark) {
                icon.innerHTML = '<path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Z"/>';
            } else {
                icon.innerHTML = '<path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"/><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"/><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"/><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"/><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"/><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"/><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"/><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"/><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"/>';
            }

            localStorage.setItem('darkMode', isDark ? 'dark' : 'light');
        }

        function loadDarkModePreference() {
            const savedMode = localStorage.getItem('darkMode');
            if (savedMode === 'light') {
                document.body.classList.add('light-mode');
                const icon = document.getElementById('darkModeIcon');
                icon.innerHTML = '<path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"/><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"/><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"/><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"/><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"/><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"/><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"/><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"/><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"/>';
            }
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const existingMsg = document.getElementById('notificationMessage');
            if (existingMsg) existingMsg.remove();

            const msg = document.createElement('div');
            msg.id = 'notificationMessage';
            msg.className = 'notification';
            if (type === 'error') {
                msg.style.background = 'var(--danger)';
            }
            msg.textContent = message;
            document.body.appendChild(msg);

            setTimeout(() => msg.remove(), 3000);
        }

        // Normalize string for search
        function normalizeString(str) {
            return str.toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '');
        }

        // Load movies
        async function loadMovies(forceRefresh = false) {
            const container = document.getElementById('moviesContainer');

            // Show skeleton loading
            const skeletonCount = 8;
            container.innerHTML = Array(skeletonCount).fill(0).map(() => `
                <div class="skeleton-card">
                    <div class="skeleton-poster"></div>
                    <div class="skeleton-content">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-meta"></div>
                    </div>
                </div>
            `).join('');

            try {
                const timestamp = forceRefresh ? `?t=${Date.now()}` : '';
                const response = await fetch(`movies.json${timestamp}`);

                if (!response.ok) {
                    throw new Error('Erreur réseau');
                }

                allMovies = await response.json();
                filteredMovies = [...allMovies];
                sortMovies();
            } catch (error) {
                console.error('Erreur:', error);
                container.innerHTML = `
                    <div class="loading">
                        <div style="color: var(--danger); font-weight: 600; margin-bottom: 8px;">Erreur de chargement</div>
                        <div style="color: var(--text-tertiary); font-size: 14px;">
                            Sur GitHub Pages, ce problème ne devrait pas se produire.<br>
                            En local, utilisez un serveur web (ex: python -m http.server 8080)
                        </div>
                    </div>
                `;
            }
        }

        // Sort movies
        function sortMovies() {
            const sort = currentSort;

            filteredMovies.sort((a, b) => {
                switch(sort) {
                    case 'year':
                        return a.year - b.year;
                    case 'year-desc':
                        return b.year - a.year;
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'title-desc':
                        return b.title.localeCompare(a.title);
                    case 'tmdb-rating':
                        return parseFloat(a.tmdbRating || 0) - parseFloat(b.tmdbRating || 0);
                    case 'tmdb-rating-desc':
                        return parseFloat(b.tmdbRating || 0) - parseFloat(a.tmdbRating || 0);
                    default:
                        return 0;
                }
            });

            displayMovies();
        }

        // Display movies
        function displayMovies() {
            const container = document.getElementById('moviesContainer');
            const count = document.getElementById('movieCount');

            count.textContent = `${filteredMovies.length} film${filteredMovies.length > 1 ? 's' : ''}`;

            if (filteredMovies.length === 0) {
                container.innerHTML = '<div class="loading"><div style="color: var(--text-tertiary);">Aucun film trouvé</div></div>';
                return;
            }

            container.innerHTML = filteredMovies.map(movie => {
                const data = getMoviePersonalData(movie.id);
                const badges = [];

                if (data.favorite) badges.push('<span class="badge badge-favorite">Favori</span>');
                if (data.watched) badges.push('<span class="badge badge-watched">Vu</span>');
                if (data.toWatch) badges.push('<span class="badge badge-towatch">À voir</span>');

                // Generate star rating display
                const starsHTML = data.rating > 0 ? `
                    <div class="rating-display" style="margin-top: 8px;">
                        <div class="star-rating">
                            ${Array(5).fill(0).map((_, i) => `
                                <svg class="star ${i < data.rating ? 'active' : ''}" fill="${i < data.rating ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                                </svg>
                            `).join('')}
                        </div>
                    </div>
                ` : '';

                return `
                    <div class="movie-card" onclick="openMovieModal('${movie.id}')">
                        <img class="movie-poster" src="${movie.poster}" alt="${movie.title}" loading="lazy">
                        <div class="movie-content">
                            <h3 class="movie-title">${movie.title}</h3>
                            <div class="movie-meta">
                                <span class="movie-year">${movie.year}</span>
                                ${movie.tmdbRating ? `<span class="movie-rating">${movie.tmdbRating}/10</span>` : ''}
                            </div>
                            ${badges.length > 0 ? `<div class="movie-badges">${badges.join('')}</div>` : ''}
                            ${starsHTML}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Filter by status
        function filterByStatus(status) {
            currentStatusFilter = status;

            document.querySelectorAll('.filter-pill').forEach(pill => {
                pill.classList.remove('active');
            });
            document.querySelector(`[data-filter="${status}"]`).classList.add('active');

            if (status === 'all') {
                filteredMovies = [...allMovies];
            } else {
                filteredMovies = allMovies.filter(movie => {
                    const data = getMoviePersonalData(movie.id);
                    return data[status] === true;
                });
            }

            const searchTerm = document.getElementById('searchInput').value;
            if (searchTerm) {
                const normalizedSearch = normalizeString(searchTerm);
                filteredMovies = filteredMovies.filter(movie =>
                    normalizeString(movie.title).includes(normalizedSearch) ||
                    normalizeString(movie.description || '').includes(normalizedSearch) ||
                    movie.year.toString().includes(normalizedSearch)
                );
            }

            sortMovies();
        }

        // Handle sort change
        function handleSortChange() {
            currentSort = document.getElementById('sortSelect').value;
            sortMovies();
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const searchTerm = normalizeString(e.target.value);

            let moviesToFilter = allMovies;
            if (currentStatusFilter !== 'all') {
                moviesToFilter = allMovies.filter(movie => {
                    const data = getMoviePersonalData(movie.id);
                    return data[currentStatusFilter] === true;
                });
            }

            if (searchTerm) {
                filteredMovies = moviesToFilter.filter(movie =>
                    normalizeString(movie.title).includes(searchTerm) ||
                    normalizeString(movie.description || '').includes(searchTerm) ||
                    movie.year.toString().includes(searchTerm)
                );
            } else {
                filteredMovies = moviesToFilter;
            }

            sortMovies();
        });

        // Open movie modal
        function openMovieModal(movieId) {
            const movie = allMovies.find(m => m.id === movieId);
            if (!movie) return;

            currentMovie = movie;
            const data = getMoviePersonalData(movieId);

            document.getElementById('modalTitle').textContent = movie.title;

            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 24px; margin-bottom: 24px;">
                    <img src="${movie.poster}" alt="${movie.title}" style="width: 100%; border-radius: var(--radius-md);">
                    <div>
                        <div style="margin-bottom: 16px;">
                            <div style="font-size: 13px; color: var(--text-tertiary); margin-bottom: 8px;">Année • Note • Classification</div>
                            <div style="display: flex; gap: 12px; flex-wrap: wrap; font-size: 14px; font-weight: 600;">
                                <span>${movie.year}</span>
                                ${movie.tmdbRating ? `<span style="color: var(--warning);">${movie.tmdbRating}/10 TMDB</span>` : ''}
                                ${movie.ageRating ? `<span>${movie.ageRating}</span>` : ''}
                            </div>
                        </div>

                        <div style="margin-bottom: 16px;">
                            <div style="font-size: 13px; color: var(--text-tertiary); margin-bottom: 8px;">Votre note</div>
                            <div class="star-rating star-rating-large" style="margin-bottom: 8px;">
                                ${Array(5).fill(0).map((_, i) => `
                                    <svg class="star ${i < data.rating ? 'active' : ''}" fill="${i < data.rating ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24" onclick="setMovieRating('${movieId}', ${i + 1}); event.stopPropagation();">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                                    </svg>
                                `).join('')}
                            </div>
                            ${data.rating > 0 ? `<div style="font-size: 12px; color: var(--text-tertiary);">Votre note: ${data.rating}/5</div>` : '<div style="font-size: 12px; color: var(--text-tertiary);">Cliquez pour noter</div>'}
                        </div>

                        <div style="margin-bottom: 16px;">
                            <div style="font-size: 13px; color: var(--text-tertiary); margin-bottom: 8px;">Synopsis</div>
                            <div style="font-size: 14px; line-height: 1.6;">${movie.description || 'Aucune description'}</div>
                        </div>

                        <div style="margin-bottom: 16px;">
                            <div style="font-size: 13px; color: var(--text-tertiary); margin-bottom: 8px;">Versions disponibles</div>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                ${movie.versions.map(v => `
                                    <a href="${v.link}" target="_blank" class="btn btn-primary">
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        Regarder ${v.type}
                                    </a>
                                `).join('')}
                            </div>
                        </div>

                        <div>
                            <div style="font-size: 13px; color: var(--text-tertiary); margin-bottom: 8px;">Actions rapides</div>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="btn ${data.favorite ? 'active' : ''}" onclick="toggleMovieStatus('${movieId}', 'favorite'); event.stopPropagation();">
                                    Favori
                                </button>
                                <button class="btn ${data.watched ? 'active' : ''}" onclick="toggleMovieStatus('${movieId}', 'watched'); event.stopPropagation();">
                                    Vu
                                </button>
                                <button class="btn ${data.toWatch ? 'active' : ''}" onclick="toggleMovieStatus('${movieId}', 'toWatch'); event.stopPropagation();">
                                    À voir
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                ${data.watchDate ? `
                    <div style="background: var(--bg-tertiary); padding: 12px; border-radius: var(--radius-sm); margin-bottom: 16px; font-size: 13px;">
                        Vu le ${new Date(data.watchDate).toLocaleDateString('fr-FR', { year: 'numeric', month: 'long', day: 'numeric' })}
                    </div>
                ` : ''}

                <div>
                    <label class="form-label">Notes personnelles</label>
                    <textarea class="form-textarea" id="movieNotes" placeholder="Ajoutez vos notes...">${data.notes || ''}</textarea>
                    <button class="btn btn-success" onclick="saveMovieNotes('${movieId}')" style="margin-top: 12px;">
                        Sauvegarder les notes
                    </button>
                </div>
            `;

            document.getElementById('movieModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeMovieModal() {
            document.getElementById('movieModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Toggle movie status
        function toggleMovieStatus(movieId, statusType) {
            if (!personalData[movieId]) {
                personalData[movieId] = getMoviePersonalData(movieId);
            }

            personalData[movieId][statusType] = !personalData[movieId][statusType];

            if (statusType === 'watched' && personalData[movieId].watched) {
                personalData[movieId].watchDate = new Date().toISOString();
            } else if (statusType === 'watched' && !personalData[movieId].watched) {
                personalData[movieId].watchDate = null;
            }

            savePersonalData();
            displayMovies();

            if (currentMovie && currentMovie.id === movieId) {
                openMovieModal(movieId);
            }
        }

        // Save movie notes
        function saveMovieNotes(movieId) {
            const notes = document.getElementById('movieNotes').value;

            if (!personalData[movieId]) {
                personalData[movieId] = getMoviePersonalData(movieId);
            }

            personalData[movieId].notes = notes;
            savePersonalData();
            showNotification('Notes sauvegardées !', 'success');
        }

        // Suggest modal
        function openSuggestModal() {
            document.getElementById('suggestModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeSuggestModal() {
            document.getElementById('suggestModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            document.getElementById('suggestionForm').reset();
        }

        // Toggle website updates
        function toggleWebsiteUpdates() {
            const panel = document.getElementById('websiteUpdates');
            const changelog = document.getElementById('movieChangelog');

            changelog.classList.remove('active');

            if (panel.classList.contains('active')) {
                panel.classList.remove('active');
            } else {
                panel.classList.add('active');
            }
        }

        // Toggle movie changelog
        async function toggleMovieChangelog() {
            const panel = document.getElementById('movieChangelog');
            const updates = document.getElementById('websiteUpdates');

            updates.classList.remove('active');

            if (panel.classList.contains('active')) {
                panel.classList.remove('active');
            } else {
                panel.classList.add('active');
                await loadMovieChangelog();
            }
        }

        // Load movie changelog
        async function loadMovieChangelog() {
            const content = document.getElementById('movieChangelogContent');

            try {
                const response = await fetch('changelog.json');
                const changelog = await response.json();

                let html = '';

                changelog.forEach(entry => {
                    const date = new Date(entry.date);
                    const dateStr = date.toLocaleDateString('fr-FR', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    html += `
                        <div class="update-item">
                            <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: 8px;">${dateStr}</div>
                    `;

                    if (entry.changes.added && entry.changes.added.length > 0) {
                        html += `<div style="margin-bottom: 8px;"><strong style="color: var(--success);">Ajoutés:</strong> ${entry.changes.added.map(m => m.title).join(', ')}</div>`;
                    }

                    if (entry.changes.edited && entry.changes.edited.length > 0) {
                        html += `<div style="margin-bottom: 8px;"><strong style="color: var(--accent);">Modifiés:</strong> ${entry.changes.edited.map(m => m.title).join(', ')}</div>`;
                    }

                    if (entry.changes.deleted && entry.changes.deleted.length > 0) {
                        html += `<div style="margin-bottom: 8px;"><strong style="color: var(--danger);">Supprimés:</strong> ${entry.changes.deleted.map(m => m.title).join(', ')}</div>`;
                    }

                    html += '</div>';
                });

                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = '<div class="update-item"><div style="color: var(--text-tertiary);">Impossible de charger l\'historique</div></div>';
            }
        }

        // Close modals on backdrop click
        document.getElementById('movieModal').addEventListener('click', function(e) {
            if (e.target === this) closeMovieModal();
        });

        document.getElementById('suggestModal').addEventListener('click', function(e) {
            if (e.target === this) closeSuggestModal();
        });

        document.getElementById('exportModal').addEventListener('click', function(e) {
            if (e.target === this) closeExportModal();
        });

        document.getElementById('importModal').addEventListener('click', function(e) {
            if (e.target === this) closeImportModal();
        });

        // Welcome modal
        function closeWelcomeModal() {
            document.getElementById('welcomeModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            localStorage.setItem('hasVisited', 'true');
        }

        function checkFirstVisit() {
            const hasVisited = localStorage.getItem('hasVisited');
            if (!hasVisited) {
                document.getElementById('welcomeModal').classList.add('active');
                document.body.style.overflow = 'hidden';
            } else {
                document.getElementById('welcomeModal').remove();
            }
        }

        // Form submission handler
        document.getElementById('suggestionForm').addEventListener('submit', function(e) {
            // Set redirect URL to current page
            document.getElementById('formRedirect').value = window.location.href;
            // Show loading overlay
            document.getElementById('loadingOverlay').classList.add('active');
            // Form will submit normally and redirect via FormSubmit
        });

        // Mobile navigation filter
        function mobileNavFilter(filter) {
            // Update active state
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-nav="${filter}"]`)?.classList.add('active');

            // Apply filter
            filterByStatus(filter);

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Open account menu from mobile nav
        function openAccountMenu() {
            const menu = document.getElementById('accountMenu');
            if (window.innerWidth <= 768) {
                // On mobile, open export modal directly
                document.querySelectorAll('.mobile-nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector('[data-nav="account"]')?.classList.add('active');

                // Create a simple modal for account actions
                const accountModal = document.createElement('div');
                accountModal.className = 'modal-backdrop active';
                accountModal.style.zIndex = '2000';
                accountModal.innerHTML = `
                    <div class="modal" style="max-width: 400px;">
                        <div class="modal-header">
                            <h2 class="modal-title">Mon compte</h2>
                            <button class="modal-close" onclick="this.closest('.modal-backdrop').remove();">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                        <div class="modal-body" style="display: flex; flex-direction: column; gap: 12px;">
                            <button class="btn btn-success" onclick="openExportModal(); this.closest('.modal-backdrop').remove();" style="width: 100%; justify-content: center;">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                </svg>
                                Exporter mes données
                            </button>
                            <button class="btn btn-purple" onclick="openImportModal(); this.closest('.modal-backdrop').remove();" style="width: 100%; justify-content: center;">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                                </svg>
                                Importer mes données
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(accountModal);
                accountModal.addEventListener('click', function(e) {
                    if (e.target === this) this.remove();
                });
            } else {
                toggleAccountMenu();
            }
        }

        // Set movie rating
        function setMovieRating(movieId, rating) {
            if (!personalData[movieId]) {
                personalData[movieId] = getMoviePersonalData(movieId);
            }

            // If clicking the same rating, remove it
            personalData[movieId].rating = personalData[movieId].rating === rating ? 0 : rating;

            savePersonalData();
            displayMovies();

            // Update modal if open
            if (currentMovie && currentMovie.id === movieId) {
                openMovieModal(movieId);
            }
        }

        // AdBlock Detection
        function detectAdBlock() {
            // Check if AdSense is loaded
            let adBlockEnabled = false;

            // Create a test ad element
            const testAd = document.createElement('div');
            testAd.innerHTML = '&nbsp;';
            testAd.className = 'adsbygoogle';
            testAd.style.cssText = 'width: 1px !important; height: 1px !important; position: absolute !important; left: -10000px !important; top: -1000px !important;';

            document.body.appendChild(testAd);

            setTimeout(() => {
                // Check if the ad was blocked
                if (testAd.offsetHeight === 0 || !window.adsbygoogle || window.adsbygoogle.loaded !== true) {
                    adBlockEnabled = true;
                }

                document.body.removeChild(testAd);

                if (adBlockEnabled) {
                    showAdBlockPopup();
                }
            }, 100);
        }

        function showAdBlockPopup() {
            const popup = document.getElementById('adblockPopup');
            const closeBtn = document.getElementById('adblockCloseBtn');
            const timerDisplay = document.getElementById('adblockTimer');
            const timerText = document.getElementById('adblockTimerText');

            popup.classList.add('active');
            document.body.style.overflow = 'hidden';

            let timeLeft = 20;

            const countdown = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                timerText.textContent = timeLeft;

                if (timeLeft <= 0) {
                    clearInterval(countdown);
                    closeBtn.classList.add('enabled');
                    closeBtn.innerHTML = 'Fermer';
                    document.querySelector('.adblock-timer').style.display = 'none';
                }
            }, 1000);
        }

        function closeAdblockPopup() {
            const closeBtn = document.getElementById('adblockCloseBtn');
            if (closeBtn.classList.contains('enabled')) {
                document.getElementById('adblockPopup').classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        // Initialize
        loadPersonalData();
        loadDarkModePreference();
        loadMovies();
        checkFirstVisit();

        // Detect AdBlock after page loads
        window.addEventListener('load', () => {
            setTimeout(detectAdBlock, 2000);
        });
    </script>
</body>
</html>
